## Backend

### 1. Install pyenv and virtualenv

Read about pyenv here https://github.com/pyenv/pyenv as well as info on how to install it.
You may also need to install virtualenv in order to complete step 2.

### 2. Installing Prerequisites
The steps below attempt to install Python version 3.10.1 within your pyenv environment. If you computer is unable to install this particular version, you can feel free to use a version that works for you, but note that you may also be required to update existing parts of the codebase to make it compatible with your installed version.
```
cd root/of/project
pyenv install 3.10.1
pyenv virtualenv 3.10.1 okc
pyenv local okc
eval "$(pyenv init -)"
pyenv activate okc
pip install -r backend/requirements.txt
```

### 3. Starting the Backend
Start the backend by running the following commands
```
cd /path/to/project/backend
python manage.py runserver
```

You may ignore the warnings regarding the database not being set such as: `WARNING:root:No DATABASE_URL environment variable set, and so no databases setup`

The backend should run on http://localhost:8000/.


## Frontend

### 1. Installing Prerequisites
Install Node.js (16.x.x), then run the following commands
```
cd /path/to/project/frontend
# Install Angular-Cli
npm install -g @angular/cli@12.1.0 typescript@4.6.4 --force
# Install dependencies
npm install --force
```

### 2. Starting the Frontend
Start the frontend by running the following commands
```
cd /path/to/project/frontend
npm start
```
The frontend should run on http://localhost:4200/. Visit this address to see the app in your browser.

# Deploying through Railway

After you finish the project, we ask that you attempt to deploy your work to make it easily viewable in a browser. Below are instructions on deploying the app through Railway. It should not be necessary to give any credit card information to Railway as the deployment instructions are intended to solely utilize free services on the platform.

### 1. Install the Railway CLI
```
npm i -g @railway/cli
```
### 2. Login to the Railway CLI and create an account through your Github account in your browser
```
railway login
```
### 3. Initialize a Railway Project

Run the command below to create a project (you can use &lt;githubusername&gt;-thunder-2025 for your project name when prompted)
```
railway init
```
After the project is created, you can visit the link generated to view the Project's Architecture and modify the services we will generate in the following steps.

### 4. Add a Postgres instance to your project
Run the command below to add a Postgres instance to your Railway Project's architecture:
```
railway add --database postgres --service database
```

You should now see a "database" block in the Project Architecture interface. If not, you should be able to see it after refreshing the page.
**Wait for the Postgres instance to indicate that it has deployed successfully before moving onto the next step.**

### 5. Add a backend service and connect it to your app's Postgres instance
Run the command below as a single line:
```
railway add \
  --service backend \
  --variables 'DATABASE_URL=${{Postgres.DATABASE_URL}}' \
  --variables 'PGDATABASE=${{Postgres.PGDATABASE}}' \
  --variables 'PGHOST=${{Postgres.PGHOST}}' \
  --variables 'PGPASSWORD=${{Postgres.PGPASSWORD}}' \
  --variables 'PGPORT=${{Postgres.PGPORT}}' \
  --variables 'PGUSER=${{Postgres.PGUSER}}' \
  --variables 'DJANGO_SETTINGS_MODULE=app.settings'
```

You should now see a "backend" block in the Project Architecture interface. If not, you should be able to see it after refreshing the page.

### 6. Configure your backend service
- Select the backend service by clicking on the "backend" block in the Railway Project Architecture interface
- Connect your backend service to your project's Github repository by navigating to Settings and selecting "Connect Repo" in the Source section. From here, select your project's Github repo
- In the same Source section, set the root directory to `backend`
- In the Networking section select "Generate Domain" under Public Networking, and keep the port set as the default (8080)
- Put the same domain generated by the backend in `/path/to/project/frontend/src/environments/environment.prod.ts` **(including the https:// and ignoring the final forward slash / after the domain)** to allow the frontend that you will deploy to get responses from your backend. Make sure you push this change to your main branch

Ex: if the backend domain generated is `backend-thunder-technical.xyz.railway.app`, your `environment.prod.ts` should look like:
```
export const environment = {
  production: true,
  BACKEND_PUBLIC_DOMAIN: 'https://backend-thunder-technical.xyz.railway.app'
};
```

Once you finish configuring your backend service, you can apply the changes by selecting "Deploy" at the top of the interface.

If your backend service isn't able to successfully deploy, try deleting the service by navigating to the bottom of settings, selecting "Delete service", and deploying the destructive changes when prompted. Then try re-doing steps 5 and 6.

### 7. Add a frontend service
Run the command below to add a frontend service. Note: You won't need to add any variables for the frontend service, so you can press enter to skip that portion when prompted.
```
railway add --service frontend
```

You should now see a "frontend" block in the Project Architecture interface. If not, you should be able to see it after refreshing the page.

### 8. Configure your frontend service

- Connect your frontend service to your project's Github repository by clicking the "frontend" block in the Railway Project Architecture interface, navigating to Settings, and selecting "Connect Repo" in the Source section. From here, select your project's Github repo
- In the same Source section, set the root directory to `frontend`
- **Make sure the commit including the change to add your backend service's public domain to `environment.prod.ts` is pushed to your repo**
- In the Networking section select "Generate Domain" under Public Networking, and keep the port set as the default (8080)

Once you finish configuring your frontend service, you can apply the changes by selecting "Deploy" at the top of the interface.

Once deployed, your frontend should be accessible from the domain you generated, and it should be able to access your backend service. **Note down the domain generated for the frontend service in `SUBMISSION.md` as this will be the URL that allows us to access your project.**

### 9. Dump the contents of your local database to the Railway Postgres instance
```
cd /path/to/project/backend/scripts
railway connect Postgres
```
In your railway db psql shell run:
```
-- should be in the psql railway terminal with railway=#
\i dbexport.psql
```
